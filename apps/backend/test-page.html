<!DOCTYPE html>
<html>
<head>
    <title>Filter System Demo</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: Arial, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 20px; border-radius: 8px; }
        .filters { background: #ecf0f1; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .filter-row { display: flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; }
        .filter-box { flex: 1; min-width: 200px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #bdc3c7; border-radius: 4px; }
        .buttons { display: flex; gap: 10px; }
        button { padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .apply-btn { background: #3498db; color: white; }
        .reset-btn { background: #e74c3c; color: white; }
        .results { margin-top: 30px; }
        .result-count { background: #27ae60; color: white; padding: 10px; border-radius: 4px; display: inline-block; }
        .places-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .place-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .place-name { font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #2c3e50; }
        .place-detail { margin: 5px 0; color: #34495e; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; }
        .location-badge { background: #e8f4fc; color: #2980b9; }
        .type-badge { background: #e8f6f3; color: #16a085; }
        .budget-badge { background: #fef9e7; color: #f39c12; }
        .api-url { background: #2c3e50; color: white; padding: 10px; border-radius: 4px; font-family: monospace; margin: 10px 0; word-break: break-all; }
    </style>
</head>
<body>
    <div class="header">
        <h1>NextStop Filter System</h1>
        <p>Phase 3: Location, Type, Budget Filters</p>
    </div>
    
    <div class="filters">
        <h2>Apply Filters</h2>
        <div class="filter-row">
            <div class="filter-box">
                <label for="location">üìç Location</label>
                <input type="text" id="location" placeholder="e.g., Toronto, Vancouver">
            </div>
            <div class="filter-box">
                <label for="type">üè∑Ô∏è Type</label>
                <select id="type">
                    <option value="">All Types</option>
                    <option value="Restaurant">Restaurant</option>
                    <option value="Cafe">Cafe</option>
                    <option value="Park">Park</option>
                    <option value="Hotel">Hotel</option>
                    <option value="Museum">Museum</option>
                </select>
            </div>
            <div class="filter-box">
                <label for="budget">üí∞ Budget</label>
                <select id="budget">
                    <option value="">All Budgets</option>
                    <option value="Low">Low ($)</option>
                    <option value="Medium">Medium ($$)</option>
                    <option value="High">High ($$$)</option>
                </select>
            </div>
        </div>
        <div class="buttons">
            <button class="apply-btn" onclick="applyFilters()">Apply Filters</button>
            <button class="reset-btn" onclick="resetFilters()">Reset Filters</button>
        </div>
        
        <div class="api-url" id="apiUrl">API: Loading...</div>
    </div>
    
    <div class="results">
        <h2>Results</h2>
        <div class="result-count" id="resultCount">0 places found</div>
        
        <div class="places-grid" id="placesGrid">
            <!-- Results will appear here -->
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';
        let currentFilters = {};
        
        function updateApiUrl() {
            const params = new URLSearchParams(currentFilters);
            const url = `${API_BASE}/api/places${params.toString() ? '?' + params.toString() : ''}`;
            document.getElementById('apiUrl').textContent = `API: ${url}`;
            return url;
        }
        
        async function applyFilters() {
            currentFilters = {
                location: document.getElementById('location').value.trim(),
                type: document.getElementById('type').value,
                budget: document.getElementById('budget').value
            };
            
            // Remove empty filters
            Object.keys(currentFilters).forEach(key => {
                if (!currentFilters[key]) delete currentFilters[key];
            });
            
            const apiUrl = updateApiUrl();
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('resultCount').textContent = `${data.count} place(s) found`;
                    displayPlaces(data.data);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                document.getElementById('resultCount').textContent = 'Error loading data';
                document.getElementById('placesGrid').innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        function resetFilters() {
            document.getElementById('location').value = '';
            document.getElementById('type').value = '';
            document.getElementById('budget').value = '';
            currentFilters = {};
            applyFilters();
        }
        
        function displayPlaces(places) {
            const grid = document.getElementById('placesGrid');
            
            if (places.length === 0) {
                grid.innerHTML = '<p>No places found with the selected filters.</p>';
                return;
            }
            
            grid.innerHTML = places.map(place => `
                <div class="place-card">
                    <div class="place-name">${place.name}</div>
                    <div class="place-detail">
                        <span class="badge location-badge">üìç ${place.location}</span>
                        <span class="badge type-badge">üè∑Ô∏è ${place.type}</span>
                        <span class="badge budget-badge">üí∞ ${place.budget}</span>
                    </div>
                    <div class="place-detail"><strong>ID:</strong> ${place.id}</div>
                </div>
            `).join('');
        }
        
        // Load on page load
        window.onload = function() {
            updateApiUrl();
            applyFilters();
        };
    </script>
</body>
</html>